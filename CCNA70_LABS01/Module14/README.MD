Specialist 20201212
# Transport Layer
Передача данных между процессами (например один браузер - yandex, второй -Chrome). На транспортном уровне 2 протокола TCP, UDP

![](./pictures/1.jpg)   

## TCP
Сегменты нумеруются, отслеживается отправка, получение, повторная отправка, воспроизведение в определенном порядке, подстраивается под среду передачи (flow control)

## UDP
Ленивая медуза - просто отправляет сегменты, не нумерую их и не занимаясь ничем, кроме отправки сегментов

![](./pictures/2.jpg)

Так что надо использовать тот протокол, которыйподходит под конкретный случай. Как и с протоколами ftp,tftp и т.д.

# TCP
Заголовок
![](./pictures/3.jpg)
   * SP
   * DP
   * Seq Num
   * Ack Num
   ...
   * window - окно отправки (в байтах), которое без подтверждения, то есть сколько сегментов можно отправить без подтверждение. Алгоритмов - много: https://habr.com/ru/post/168407/

# UDP
![](./pictures/4.jpg)

еще про порты: каждому процессу соответствует свой Process ID [PID]. IANA регулирует общеиспользуемые DST порты, которые используются известными программами. 

Что касается Src портов, то их номерами управляет Kernel OS (ядро) и хранит их в соответствующей табличке.

Таким образом ОС каждому PID выделяет свой, один из 65535 портов TCP или UDP, то есть порт - связующее звено между приходящими данными и процессом (PID). Порты <1024 - well known протоколы

![](./pictures/5.jpg)

просмотреть текущую табличку ядра ___netstst___ с параметрами -a, -b и т.д.

![](./pictures/6.jpg)

## TCP еще раз
Перед отправкой данных - создаем сессию, для этого используем поле Control Bits: 
   * Отправитель в сегменте отправляет Syn с определенным значением
   * получатель отправляет Syn, Ack
   * отправитель отправляет Ack
   * пошли данные

Перед закрытием - тоже идет отправка определенных флагов:
   * отправитель Fin
   * получатель Ack
   * Получатель Fin
   * Отправитель Ack

![](./pictures/7.jpg)

Если получатель занят, то отправитель отправляет RST (reset) в ответ на Syn. 

Сканеры портов - так и работают - отправляют Syn на каждый порт, а потом дополнительно бомбят открытые

DDOS - работа на истощение ресурсов SynFlood - флужение Syn-ами

UDP просканировать нельзя, так как оно не устанавливает сессию перед открытием
