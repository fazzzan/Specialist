# NETACAD
## 2.1.2 Включение OSPF
Процесс OSDPFv2 включается командой, с заданием process-ID (1-65535)
```
router ospf <XX>
```
После ввода этой команды, мы приступаем к настройкам процесса OSPF:
- RID [router ID]  - 32-bit значение, похожее на IPv4 адрес. Это значение должно быть уникальным в OSPF домене. Задать его можно:
   - вручную ```router-id <xxxxx>```, где xxxxx - 32-bit значение
   - автоматически: 
       - Если есть хоть один ___lo___ IF, то любой максимальный ip из всех Lo.
       - Если нет Lo, то любой максимальный из всех имеющихся
Для уверенного последующего траблшутинга, часто рекомендуют RID задавать вручную
```
router ospf 10
router-id 1.1.1.1

do sho ip proto | in Router ID
```

![](./pictures/01.jpg)

Если по каким-то причинам надо ___сменить RID___, то делается это ___только с последующим сбросом OSPF___:
```
clear ip ospf process
```

В этот момент отвалятся все соседства и пропадут маршруты в целевые OSPF-сети

Влияет значение RID на алгоритм некоторых действий:
   - ExStart состояние: у кого больший RID, тот станет master и начнет обмене DBD-шками
   - участвует в выборах DR/BDR - тот, у кого больше всех - становится DR, тот у кого чуть меньше - BDR

Ахтунг-вопрос:

![](./pictures/02.jpg)

## 2.2.1
Если перед нами PPP-сеть, то IF, который подключается к OSPF может быть однозначно идентифицирован подсеткой этого IF:

```
network <network-address> <wildcard-mask> area <area-id>
```

- Любой IF, который определен таким образом в OSPF - будет задействован в OSPF-обмене (отправить/получать ospf-пакеты).
- area-id должна быть одинакова на всех роутерах, в одной AREA. Если всего одня area, то рекомендуется использовать area-id=0

Также процесс OSPF можно включить и на каком-либо IF непосредственно:
```
ip ospf <process-id> area <area-id>
```

Для безопасности, IF через которые OSPF ходить не должен (это те. которые не подключены к OSPF-соседям) - надо делать пассивными:
```
router ospf <10>
passive-intarface loopback 0

...

R1# show ip protocols
...
  Passive Interface(s):
    Loopback0
```

## 2.2.11 DR/BDR в PPP - подключении

Даже если подключение PPP - в канале ethernet все равно будут DR/BDR.

![](./pictures/03.jpg)

Если по каким-либо причинам это надо отключить, (например мы скоммутировали 2 роутер по Ethernet-подключению, но мы знаем, что их всего лишь 2)
```
ing gi 0/0
ip ospf netwo point-to-point
```

![](./pictures/04.jpg)

отсюда фича, при работе с Loopback: если нам надо получать не /32 подсеть, то можно сконфигурировать Lo point-to-point и тогда на соседа прилетит /24:

![](./pictures/04.jpg)

## лаба 2.2.13

![](./pictures/06.jpg)

Задачи:
- Configure Router IDs.
- Configure Networks for OSPF Routing.
- Configure Passive Interfaces.
- Verify OSPF configuration.

- [pdf](labs/2.2.13-packet-tracer---point-to-point-single-area-ospfv2-configuration.pdf)
- [pka](2.2.13-packet-tracer---point-to-point-single-area-ospfv2-configuration.pka)

Лаба выполнена, но удовольствие не получено, так как, так как не разобравшись, я подумал что в PT не видно DR/BDR. Пересобрал в GNS3 и понял что соединение PPP, поэтому DR/BDR - не будет: это PPP, детка

![](./pictures/07.jpg)

[gns3](labs/2.2.13_exp.gns3project)

![](./pictures/09.jpg)



___По итогу прочтения - я не совсем понял, зачем так много времени посвящено point-to-point сетям___

## 2.3.1 OSPF Network Types
Второй тип сетей OSPF - multiaccess, этот тип будет отличаться от ppp - сети, так как тут будут выделенные роутеры DR/BDR, и DR будет отвечать за распространение LSA. DR использует MC-пакеты на адрес 224.0.0.5 (всем OSPF - роутерам). BDR - некий пассивный дублер DR, который втихаря все слушает ит также поддерживает соседские отношения со всеми другими соседями AREA.

Все остальные роутеры - DROTHER, и они уже используют MC 224.0.0.6 для взаимодействия друг с другом и DR/BDR. Как ранее говорилось, тот у кого больше RID - станет DR, у кого меньше - BDR и перевыборов не будет, пока не сдохнет DR или BDR.

![](./pictures/08.jpg)

```
show ip ospf interface <Gi0/0/0>
```

![](./pictures/10.jpg)

Как мы помним, роутеры OSPF находятся в каком-то из перечисленных состояний:
- ___FULL/DROTHER___ - DR или BDR в состоянии ___full___-соседства по отношению к non-DR or BDR роутерам. Обмен с такими присутствует в полном объеме: Hello packets, updates (LSU), queries (LSR), replies (LSR), and acknowledgments (LSAck).
- ___FULL/DR___ - ___full___-соседство с DR соседом. Обмен также в полном объеме: Hello packets, updates, queries, replies, and acknowledgments.
- ___FULL/BDR___ - ___full___-соседство с BDR соседом. Также обмен в полном объеме: Hello packets, updates, queries, replies, and acknowledgments.
- ___2-WAY/DROTHER___ - non-DR и non-BDR (DROTHER) роутеры также имеют отношения соседства между собой. Обмен ТОЛЬКО Hello packets.

Смотрим на состояние: нормальное состояние - FULL. Если R завис в каком-то другом состоянии (за исключением 2-WAY, как показано выше), то у него есть проблемы формирования соседства (разные таймеры, MTU и т.д.)
